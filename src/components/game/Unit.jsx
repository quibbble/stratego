import React, { forwardRef } from "react";
import { useDraggable } from '@dnd-kit/core';

export const TxtMap = {
    "flag": "f",
    "bomb": "b",
    "water": "w",
    "spy": "s", 
    "scout": "1", 
    "miner": "2", 
    "sergeant": "3", 
    "lieutenant": "4",
	"captain": "5", 
    "major": "6", 
    "colonel": "7", 
    "general": "8", 
    "marshal": "9"
}

export const SvgMap = {
    "flag": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m74.59,34.02s-9.64,3.96-20.07,2.05c-6.89-1.26-21.94,4.65-21.94,4.65l-1-3.41s13.57-5.63,22.25-4.31c11.89,1.81,19.58-2.39,19.58-2.39l-1.6-4.6s-10.23,5.31-19.73,3.02c-7.54-1.83-21.84,3.68-21.84,3.68l-1.04-3.56s13.02-5.26,22.88-3.35c10.08,1.95,18.52-3.28,18.52-3.28l-2.07-5.98s-4.48,4.48-16.96,3.85c-12.11-.61-18.74,1.68-21.71,3.17.29-.49.46-1.05.46-1.66,0-1.81-1.47-3.28-3.29-3.28s-3.28,1.47-3.28,3.28c0,1.53,1.04,2.8,2.45,3.17l17.6,57.55c.19.63.86.99,1.49.79l1.01-.31c.63-.19.99-.86.8-1.49l-10.74-35.12c2.34-2.26,7.74-5.67,18.68-4.95,12.54.82,21.21-2.74,21.21-2.74l-1.66-4.78Zm-48.85-12.31c-.09.86-.48,1.52-.88,1.48-.39-.04-.64-.77-.54-1.63.09-.87.48-1.53.87-1.49.4.04.64.77.55,1.64Zm12.98,41.38c-.12,0-2.63-7.86-5.61-17.6-2.91-9.53-5.19-17.32-5.19-17.71.12,0,2.63,7.87,5.6,17.59,2.98,9.75,5.31,17.69,5.2,17.72Z"/></g></svg>,
    "bomb": <svg mlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m55.16,41.18c.27-.41.43-.9.43-1.43v-.43c0-1.41-1.14-2.55-2.55-2.55h-1.42c.02-1.29.25-2.64.99-3.24.63-.51.93-.47,2.48.35,1.37.73,3.42,1.82,5.65.43,3.52-2.18,3.97-6.29,3.99-6.46.11-1.1-.68-2.07-1.77-2.19-1.1-.11-2.08.68-2.21,1.77,0,.02-.3,2.36-2.12,3.49-.21.13-.56.02-1.66-.57-1.54-.81-4.11-2.18-6.88.07-1.98,1.61-2.46,4.25-2.48,6.35h-.92c-1.41,0-2.55,1.14-2.55,2.55v.43c0,.35.07.69.2,1-10.17,2.1-17.81,11.11-17.81,21.91,0,12.35,10.02,22.37,22.37,22.37s22.38-10.02,22.38-22.37c0-10.19-6.81-18.78-16.12-21.48Zm6.19,7.14c2.9,2.44,3.68,6.23,3.77,6.69-.17-.42-1.43-3.59-4.31-6.01-3.08-2.6-6.85-3.37-6.85-3.37,0,0,4.31.09,7.39,2.69Zm-13.83-10.94c1.04,0,1.88.27,1.88.27,0,0-.81-.05-1.88-.05-1.06.01-1.88.05-1.88.05,0,0,.84-.27,1.88-.27Zm1.39,44.33c-10.53,0-19.06-8.53-19.06-19.05,0,0,4.87,10.78,12.84,10.78s10.99-9.09,16.84-10.67c4.85-1.32,8.18,3.45,6.82,7.54-2.94,6.71-9.64,11.4-17.44,11.4Z"/><path d="m73.41,22.83l-3.39-1.82c-.07-.04-.08-.14-.02-.2l2.76-2.66c.1-.09.01-.24-.11-.21l-3.68,1.11c-.08.02-.16-.04-.16-.12l.07-3.84c0-.13-.16-.17-.22-.06l-1.83,3.38c-.04.07-.14.08-.19.02l-2.67-2.76c-.09-.09-.24,0-.2.12l1.1,3.68c.02.08-.04.15-.12.15l-3.84-.07c-.12,0-.17.17-.06.23l3.38,1.82c.08.04.09.14.03.19l-2.77,2.67c-.09.09,0,.24.12.2l3.68-1.1c.08-.02.16.04.16.12l-.07,3.84c0,.13.16.17.22.06l1.83-3.38c.04-.07.13-.09.19-.03l2.67,2.77c.08.09.23,0,.2-.12l-1.1-3.68c-.03-.08.03-.16.11-.16l3.85.08c.12,0,.17-.17.06-.23Zm-4.17-1.33l-1.24.2s-.05.04-.03.06l.57,1.12s-.02.08-.06.05l-1.02-.73s-.05-.01-.06.02l-.39,1.2s-.07.03-.08-.01l-.2-1.24s-.03-.04-.06-.03l-1.12.58s-.07-.03-.05-.06l.73-1.03s.01-.05-.02-.06l-1.2-.38s-.03-.07.01-.08l1.24-.21s.04-.03.03-.05l-.57-1.13s.02-.07.05-.05l1.03.74s.05,0,.06-.02l.39-1.2s.07-.04.07,0l.21,1.25s.03.04.06.03l1.12-.58s.07.03.05.06l-.73,1.02s-.01.06.02.06l1.19.39s.04.07,0,.08Z"/></g></svg>,
    "spy": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m29.61,57.35c.54-5.14,2.42-20.53,5.62-24.34,3.86-4.59,18.93,2.12,30.34-.11,3.99-.78,6.82,8.02,8.3,14.21-1.22.84-7.69,5.06-17.61,7.9-5.17,1.48-21.54,1.89-26.65,2.34Z"/><path d="m94.3,52.38s-17.94,7.38-39.77,11.86c-21.84,4.48-41.79,4.4-41.79,4.4l16.7-9.6s15.2.61,23.4-.73c8.2-1.33,22.21-5.39,22.21-5.39l19.24-.54Z"/></g></svg>,
    "scout": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m83.13,49.07h0s0-.01,0-.01c-.52-.88-1.13-1.71-1.81-2.47l-6.86-9.32-3.19-.8-3.08-5.47h0c-1.37-2.35-3.92-3.94-6.83-3.94-4.36,0-7.9,3.54-7.9,7.9v4.78c-.87-.9-2.09-1.47-3.44-1.47s-2.57.56-3.44,1.47v-4.78c0-4.36-3.54-7.9-7.9-7.9-2.92,0-5.47,1.58-6.83,3.94h0s-3.08,5.47-3.08,5.47l-3.19.8-6.86,9.32c-.68.76-1.29,1.58-1.81,2.47h0s0,.01,0,.01c-1.4,2.36-2.21,5.12-2.21,8.06,0,8.73,7.08,15.8,15.8,15.8,7.11,0,13.11-4.69,15.1-11.14h0s0,0,0,0c.2-.65.36-1.31.47-1.99.86,1.27,2.31,2.1,3.96,2.1s3.1-.83,3.96-2.1c.12.68.27,1.34.47,1.99h0s0,0,0,0c1.99,6.45,8,11.14,15.1,11.14,8.73,0,15.8-7.08,15.8-15.8,0-2.95-.81-5.7-2.21-8.06Zm-52.66,18.98c-6.03,0-10.92-4.89-10.92-10.92s4.89-10.92,10.92-10.92,10.92,4.89,10.92,10.92-4.89,10.92-10.92,10.92Zm19.53-8.81c-1.16,0-2.11-.94-2.11-2.11s.94-2.11,2.11-2.11,2.11.94,2.11,2.11-.94,2.11-2.11,2.11Zm19.53,8.81c-6.03,0-10.92-4.89-10.92-10.92s4.89-10.92,10.92-10.92,10.92,4.89,10.92,10.92-4.89,10.92-10.92,10.92Z"/><ellipse cx="49.31" cy="56.31" rx=".98" ry=".45" transform="translate(-25.14 48.59) rotate(-42.87)"/><path d="m66.83,48.1s3.52-1.04,7.44,1.2,4.64,7.15,4.64,7.15c0,0-2.12-4.24-5.09-6.2s-6.99-2.15-6.99-2.15Z"/><path d="m27.76,48.1s3.52-1.04,7.44,1.2,4.64,7.15,4.64,7.15c0,0-2.12-4.24-5.09-6.2s-6.99-2.15-6.99-2.15Z"/></g></svg>,
    "miner": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m87.57,57.58s-2.64-11.77-16.34-25.47c-13.7-13.7-25.98-16.72-25.98-16.72,0,0,7.2,3.24,20.11,15.54.66.63.67,1.68.03,2.33l-.56.56c-.32.32-.32.83,0,1.15l3.11,3.11c.32.32.83.32,1.15,0l.56-.56c.64-.64,1.7-.63,2.32.03,12.31,12.9,15.6,20.05,15.6,20.05Z"/><rect x="69.84" y="28.44" width="6.02" height="3.21" rx="1.61" ry="1.61" transform="translate(42.58 -42.71) rotate(45)"/><path d="m44.18,55.89l2.82,2.82-1.75,1.64s-.04.04-.06.06l-20.27,21.69c-.44.48-1.19.49-1.65.03l-2.5-2.51c-.46-.46-.45-1.21.03-1.65l21.69-20.27s.04-.04.06-.06l1.64-1.75Z"/><polygon points="51.11 54.88 48.23 57.57 45.33 54.66 48.01 51.79 51.11 54.88"/><path d="m66.94,40.08l-14.61,13.65-3.17-3.17,13.65-14.61c.44-.48,1.2-.49,1.65-.03l2.51,2.5c.46.46.45,1.21-.03,1.65Z"/><path d="m39.32,43.1c.35.35.35.91,0,1.26l-1.51,1.52c-.35.35-.91.35-1.26,0l-3.69-3.69-6.05,6.05s-6.09-6.09-12.38-12.38c-5.08-5.09,1.14-13.73,1.14-13.73,0,0,8.64-6.23,13.73-1.14l12.38,12.38-6.05,6.05,3.69,3.69Z"/><path d="m77.9,75.88l-2.33-2.33c-2.05-2.05-5-2.58-7.32-1.53l-26.53-26.53c-.39-.39-1.03-.39-1.43,0l-1.35,1.35c-.39.39-.39,1.03,0,1.43l26.53,26.53c-1.04,2.33-.46,5.33,1.65,7.43l2.21,2.21c.2.2.52.22.71.03l1.06-1.06c.19-.19.17-.51-.03-.71l-2.33-2.33c-1.58-1.58-1.64-4.05-.11-5.43,1.44-1.3,3.78-1.06,5.28.44l2.24,2.24c.2.2.52.22.71.03l1.06-1.06c.19-.19.17-.51-.03-.71Z"/><rect x="71.69" y="76.77" width="2.69" height="5.63" rx="1.35" ry="1.35" transform="translate(77.67 -28.33) rotate(45)"/></g></svg>,
    "sergeant": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m75.94,49.15c-2.37-1.96-16.74-14.31-25.09-32.14-.34-.72-1.36-.72-1.69,0-8.35,17.83-22.72,30.18-25.09,32.14-.22.18-.34.44-.34.72v32.72c0,.59.55,1.04,1.13.91,10.98-2.45,21.71-13.27,24.46-16.22.37-.4,1-.4,1.36,0,2.76,2.95,13.48,13.77,24.47,16.22.58.13,1.12-.32,1.12-.91v-32.72c0-.28-.12-.54-.33-.72Zm-3.05,28.92l-.12.08c-6.98-2.98-19.59-14.01-22.04-16.19-.21-.18-.47-.27-.73-.27s-.51.09-.72.27c-2.45,2.18-15.06,13.21-22.05,16.19l-.12-.08.05-5.26c4.31-2.43,9.43-6.44,13.76-10.12,4.33-3.69,7.87-7.03,9.02-8.13.04-.04.09-.04.12,0,2.3,2.19,14.17,13.4,22.83,18.32v5.19Zm.09-10.1c-11.98-7.28-20.72-17.07-22.36-18.97-.31-.36-.92-.36-1.23,0-1.65,1.9-10.39,11.7-22.36,18.97v-5.71c11.92-7.63,20.94-18.89,22.98-21.55,2.04,2.66,11.05,13.92,22.97,21.55v5.71Zm0-9.9c-15.49-11.96-20.94-20.29-22.25-22.57-.29-.52-1.16-.52-1.45,0-1.31,2.28-6.76,10.61-22.25,22.57v-6.27c13.97-10.92,21.32-24.63,22.98-27.97,1.66,3.35,9,17.05,22.97,27.97v6.27Z"/></g></svg>,
    "lieutenant": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m62.8,22.22c-.04-.75-.37-1.45-.89-1.99l-9.69-9.75c-1.22-1.23-3.21-1.23-4.43,0l-9.69,9.75c-.52.54-.85,1.24-.89,1.99l-4.5,64.88c-.12,1.8,1.31,3.34,3.11,3.34h28.37c1.81,0,3.24-1.54,3.11-3.34l-4.5-64.88Zm-12.79-5.66c1.91,0,3.46,1.55,3.46,3.47s-1.55,3.47-3.46,3.47-3.47-1.56-3.47-3.47,1.55-3.47,3.47-3.47Zm9.84,68.28h-19.69v-7.26h19.69v7.26Z"/></g></svg>,
    "captain": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m62.16,22.22c-.05-.75-.37-1.45-.9-1.98l-9.69-9.76c-1.22-1.22-3.21-1.22-4.43,0l-9.69,9.76c-.53.53-.85,1.23-.9,1.98l-4.49,64.88c-.13,1.8,1.31,3.34,3.11,3.34h28.37c1.81,0,3.24-1.54,3.11-3.34l-4.49-64.88Zm-12.8-5.65c1.91,0,3.46,1.55,3.46,3.46s-1.55,3.47-3.46,3.47-3.47-1.55-3.47-3.47,1.55-3.46,3.47-3.46Zm9.84,57.78h-2.29v3.24h2.29v7.26h-19.69v-7.26h2.29v-3.24h-2.29v-7.25h19.69v7.25Zm-3.79,0h-12.11v3.24h12.11v-3.24Z"/></g></svg>,
    "major": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><path d="m80.22,54.72s-1.03-5.45-7.01-11.49c2.41-7.18,1.27-12.08,1.27-12.08,0,0-6.81-3.26-15.2-1.95-2.46-8.31-9.11-10.91-9.11-10.91,0,0-10.43,7.49-11.87,12.19-8.87-1.05-14.99,1.82-14.99,1.82,0,0,1.37,9.63,3.69,12.99-5.49,3.97-7.23,10.62-7.23,10.62,0,0,4.23,4.22,10.92,5.72-1.32,7.24,2.31,10.57,2.31,10.57,0,0,7.09.95,14.2-1.9l-2.4,9.71c4.82,3.68,9,.25,9,.25,0,0,.93-6.53.65-10.36,6.86,4.68,14.29,2.43,14.29,2.43,0,0,1.64-4.2.71-10.95,7.83-.38,10.77-6.66,10.77-6.66Zm-55.74-21.33c13.87,3.7,25.64,17.99,26,18.44-.41-.19-12.84-6.03-22.23-6.5,0,0-2.93-5.49-3.77-11.94Zm7.4,27.06c-6.03-.54-10.91-4.57-10.91-4.57,8.39-7.5,29.52-3.38,29.52-3.38,0,0-9.14,2.75-18.61,7.95Zm16.64,7.7s-7.94,3.59-14.58,2.67c4.51-9.92,16.87-17.24,16.87-17.24l-2.29,14.57Zm1.97-48.32s5.19,2.68,8.33,10.27l-7.61,21.74-.72-32.01Zm23.12,12.43s0,5.98-1.56,10.64l-20.54,8.94,22.1-19.58Zm-19.52,35.44c.13-6.27-2.42-13.65-2.57-14.1.41.37,10.01,9.18,15.71,17.73,0,0-4.67,1.75-13.14-3.63Zm14.11-7.25c-5.95-3.98-16.38-8.03-16.38-8.03,0,0,1.99-1.1,9-1.1s7.38,1.58,17.94,3.3c0,0-3.11,4.91-10.56,5.83Z"/></g></svg>,
    "colonel": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><polygon points="24.26 48.87 10.8 37.35 10.8 30.86 40.32 30.86 40.32 43.52 42.59 43.52 42.59 55.84 24.26 48.87"/><polygon points="44.55 43.51 48.11 37.18 44.86 34.75 44.7 30.86 52.06 30.86 54.43 39.46 54.43 43.51 44.55 43.51"/><polygon points="72.18 61.84 79.14 61.84 79.14 69.14 20.86 69.14 20.86 61.84 27.82 61.84 32.89 63.69 42.59 63.63 42.59 58.46 50.01 61.36 57.4 58.46 57.4 63.63 67.11 63.69 72.18 61.84"/><polygon points="89.2 30.86 89.2 37.35 75.74 48.87 57.41 55.84 57.41 43.52 59.68 43.52 59.68 30.86 89.2 30.86"/><path d="m44.01,45.21v12.1l6,2.35,5.99-2.35v-12.1h-11.99Zm1.72,11.73h-.88v-7.29h.88v7.29Zm1.88,0h-.88v-7.29h.88v7.29Zm1.88,0h-.88v-7.29h.88v7.29Zm1.88,0h-.88v-7.29h.88v7.29Zm1.88,0h-.88v-7.29h.88v7.29Zm1.88,0h-.88v-7.29h.88v7.29Z"/></g></svg>,
    "general": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><polygon points="52.75 76.66 60.43 76.81 54.32 81.46 56.54 88.81 50.24 84.42 43.93 88.82 46.15 81.46 40.03 76.82 47.71 76.66 50.23 69.4 52.75 76.66"/><polygon points="52.75 56.78 60.43 56.93 54.32 61.57 56.54 68.93 50.24 64.54 43.93 68.93 46.15 61.58 40.03 56.94 47.71 56.78 50.23 49.52 52.75 56.78"/><polygon points="52.75 36.9 60.43 37.05 54.32 41.69 56.54 49.04 50.24 44.66 43.93 49.05 46.15 41.7 40.03 37.06 47.71 36.9 50.23 29.64 52.75 36.9"/><polygon points="52.75 17.01 60.43 17.17 54.32 21.81 56.54 29.16 50.24 24.78 43.93 29.17 46.15 21.82 40.03 17.18 47.71 17.02 50.23 9.76 52.75 17.01"/></g></svg>,
    "marshal": <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><g><rect fill="none" width="100" height="100"/><polygon points="53 23.24 60.9 23.4 54.61 28.17 56.9 35.73 50.42 31.22 43.94 35.74 46.22 28.18 39.93 23.41 47.82 23.25 50.41 15.79 53 23.24"/><polygon points="39.03 69.12 46.92 69.27 40.63 74.05 42.92 81.6 36.44 77.1 29.96 81.61 32.24 74.05 25.95 69.29 33.84 69.12 36.43 61.66 39.03 69.12"/><polygon points="77.46 42.41 85.36 42.56 79.07 47.34 81.36 54.89 74.88 50.39 68.4 54.9 70.68 47.34 64.39 42.58 72.28 42.41 74.87 34.95 77.46 42.41"/><polygon points="66.98 69.12 74.87 69.27 68.58 74.05 70.87 81.6 64.39 77.1 57.91 81.61 60.2 74.05 53.9 69.29 61.79 69.12 64.38 61.66 66.98 69.12"/><polygon points="28.54 42.41 36.43 42.56 30.15 47.34 32.44 54.89 25.95 50.39 19.48 54.9 21.76 47.34 15.46 42.58 23.36 42.41 25.94 34.95 28.54 42.41"/></g></svg>
}

export function DraggableUnit({ row, col, team, type, turn, selectedTeam, started, winners }) {
    const {attributes, isDragging, listeners, setNodeRef, transform} = useDraggable({
        id: "unit:" + row + "," + col,
        data: {
            row: row,
            col: col,
            type: type
        }
    });

    const style = {
        opacity: isDragging ? 0.9 : undefined,
        touchAction: "none",
        transform: transform ? `translate3d(${transform.x}px, ${transform.y}px, 0)` : undefined
    }

    return (
        <Unit ref={ setNodeRef } style={ style } 
            {...attributes} {...listeners}
            team={team} type={type} turn={turn} selectedTeam={selectedTeam} started={started} winners={winners} />
    )
}

export const Unit = forwardRef(({ team, type, turn, selectedTeam, started, winners, ...props }, ref) => {
    const selectable = (!started && selectedTeam === team) || (started && winners.length === 0 && selectedTeam === turn && type !== "bomb" && type !== "flag" && type !== "water")

    const bg = team ? `bg-${team}-500` : "bg-zinc-500"
    const cursor = selectable ? "cursor-pointer" : "cursor-default"
    const text = type ? TxtMap[type] : "?"
    const svg = type && SvgMap[type] ? SvgMap[type] : <></>
    return (
        <div ref={ ref } { ...props } className="w-full h-full">
            <div className={ `relative w-full h-full flex items-center justify-center italic text-xs md:text-sm ${bg} ${cursor}` }>
                <div className="absolute w-full h-full flex items-start justify-start p-1">{ text }</div>
                <div className="w-[70%] h-[70%] flex items-center justify-center fill-zinc-100">{ svg }</div>
            </div>
        </div>
    )
})
